<!DOCTYPE html>
<html>
<head>
    <title>Backend Connection Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #000;
            color: #fff;
        }
        button {
            background: #4f46e5;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
        }
        button:hover {
            background: #4338ca;
        }
        .result {
            margin: 20px 0;
            padding: 15px;
            background: #1a1a1a;
            border-radius: 5px;
            border-left: 4px solid #4f46e5;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .success { border-left-color: #22c55e; }
        .error { border-left-color: #ef4444; }
    </style>
</head>
<body>
    <h1>Backend Connection Test</h1>
    <p>This page tests if your browser can connect to the backend Lambda function.</p>

    <button onclick="testHealth()">Test Health Endpoint</button>
    <button onclick="testDNS()">Test DNS Resolution</button>
    <button onclick="testCORS()">Test CORS</button>
    <button onclick="clearCache()">Clear Browser Cache & Retry</button>

    <div id="results"></div>

    <script>
        const BACKEND_URL = 'https://gdknxtbsizoibcoexozxq3qysy0ljkiq.lambda-url.us-east-1.on.aws';

        function addResult(title, content, isSuccess) {
            const div = document.createElement('div');
            div.className = 'result ' + (isSuccess ? 'success' : 'error');
            div.innerHTML = `<strong>${title}</strong><br>${content}`;
            document.getElementById('results').prepend(div);
        }

        async function testHealth() {
            addResult('Testing...', 'Connecting to health endpoint...', true);
            try {
                const response = await fetch(`${BACKEND_URL}/api/health`);
                const data = await response.json();
                addResult('✅ Health Check SUCCESS', JSON.stringify(data, null, 2), true);
            } catch (error) {
                addResult('❌ Health Check FAILED', error.message + '\n\nError Type: ' + error.name, false);
            }
        }

        async function testDNS() {
            addResult('Testing...', 'Resolving DNS...', true);
            const hostname = 'gdknxtbsizoibcoexozxq3qysy0ljkiq.lambda-url.us-east-1.on.aws';
            try {
                // Try to fetch with no-cors to see if DNS works
                const response = await fetch(`https://${hostname}/api/health`, { mode: 'no-cors' });
                addResult('✅ DNS Resolution SUCCESS', `Hostname ${hostname} resolved successfully`, true);
            } catch (error) {
                addResult('❌ DNS Resolution FAILED', `Cannot resolve ${hostname}\n\nError: ${error.message}\n\nThis might be:\n- Network/ISP blocking Lambda URLs\n- DNS server issues\n- Firewall restrictions`, false);
            }
        }

        async function testCORS() {
            addResult('Testing...', 'Testing CORS headers...', true);
            try {
                const response = await fetch(`${BACKEND_URL}/api/health`);
                const corsHeaders = {
                    'access-control-allow-origin': response.headers.get('access-control-allow-origin'),
                    'access-control-allow-methods': response.headers.get('access-control-allow-methods'),
                    'access-control-allow-headers': response.headers.get('access-control-allow-headers')
                };
                addResult('✅ CORS Headers', JSON.stringify(corsHeaders, null, 2), true);
            } catch (error) {
                addResult('❌ CORS Test FAILED', error.message, false);
            }
        }

        function clearCache() {
            addResult('ℹ️ Cache Clear Instructions',
                'To clear browser cache:\n\n' +
                '1. Press Ctrl+Shift+Delete (Windows) or Cmd+Shift+Delete (Mac)\n' +
                '2. Select "Cached images and files"\n' +
                '3. Click "Clear data"\n' +
                '4. Reload this page (Ctrl+F5 or Cmd+Shift+R)\n\n' +
                'OR try opening this site in Incognito/Private mode',
                true);
        }

        // Auto-run health check on load
        setTimeout(testHealth, 1000);
    </script>
</body>
</html>
